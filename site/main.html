<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexora - Entertainment</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* --- CORE STYLES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: "Barlow", sans-serif;
            background-color: #0A1038;
            color: #ffffff;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
        }

        #particle-canvas {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; pointer-events: none;
        }

        /* --- SETUP WIZARD --- */
        #setup-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0A1038; z-index: 5000; display: flex;
            justify-content: center; align-items: center;
        }
        .setup-card {
            background: #0A135C; padding: 40px; border-radius: 20px;
            border: 2px solid #1B2CC2; width: 450px; text-align: center;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        .setup-step { display: none; }
        .setup-step.active { display: block; }
        .icon-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 20px 0; }
        .icon-opt { 
            padding: 10px; border: 1px solid #1B2CC2; border-radius: 10px; 
            cursor: pointer; transition: 0.3s; font-size: 24px;
        }
        .icon-opt:hover, .icon-opt.selected { background: #4F64FF; border-color: #fff; }
        .setup-input {
            width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #1B2CC2;
            background: #050a2d; color: white; margin: 15px 0; outline: none;
        }
        .setup-btn {
            background: #4F64FF; color: white; border: none; padding: 10px 25px;
            border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px;
        }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 70px; height: 100%; background-color: #0A135C;
            display: flex; flex-direction: column; align-items: center;
            padding: 20px 0; z-index: 10; border-right: 1px solid #1B2CC2;
        }
        .nav-item {
            width: 40px; height: 40px; display: flex; justify-content: center;
            align-items: center; border-radius: 12px; margin-bottom: 15px;
            color: #888; cursor: pointer; transition: 0.3s; font-size: 18px;
        }
        .nav-item:hover, .nav-item.active { background-color: #1B2CC2; color: #fff; }
        .spacer { flex-grow: 1; }

        /* --- MAIN CONTENT --- */
        .main-content { flex-grow: 1; position: relative; z-index: 5; padding: 20px; overflow-y: auto; }
        .view-section { display: none; width: 100%; height: 100%; flex-direction: column; align-items: center; animation: fadeIn 0.5s; }
        .view-section.active-view { display: flex; }

        /* --- GRID STYLES --- */
        .grid-container { width: 90%; max-width: 1400px; padding-top: 20px; }
        .grid-title { font-size: 2rem; margin-bottom: 25px; border-bottom: 2px solid #1B2CC2; width: 100%; padding-bottom: 10px; }
        .grid-wrapper { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 25px; }
        
        .card {
            background-color: #0A135C; border-radius: 15px; overflow: hidden;
            border: 1px solid #1B2CC2; position: relative; cursor: pointer; transition: 0.3s;
        }
        .card:hover { transform: translateY(-5px); border-color: #4F64FF; box-shadow: 0 10px 30px rgba(79, 100, 255, 0.3); }
        .card-image { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; opacity: 0.7; transition: 0.3s; }
        .card:hover .card-image { opacity: 1; }
        .card-info { padding: 15px; position: absolute; bottom: 0; width: 100%; background: linear-gradient(transparent, #0A135C); }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.9); z-index: 1000; display: none;
            justify-content: center; align-items: center; backdrop-filter: blur(8px);
        }
        .modal-window {
            width: 85vw; height: 85vh; background: #000; border: 2px solid #4F64FF;
            border-radius: 15px; position: relative; overflow: hidden; display: flex; flex-direction: column;
        }
        
        .window-controls {
            position: absolute; top: 15px; right: 15px; z-index: 1100; display: flex; gap: 10px;
        }
        .win-btn {
            width: 35px; height: 35px; border-radius: 50%; border: none;
            color: #fff; cursor: pointer; font-weight: bold; display: flex; 
            justify-content: center; align-items: center; font-size: 1rem;
        }
        .close-btn { background: #ff3333; }
        .min-btn { background: #ffcc00; color: #000; }

        /* --- ALBUM MODAL --- */
        .album-view { display: flex; height: 100%; width: 100%; background: linear-gradient(135deg, #0A135C, #000); }
        .album-art-large { width: 40%; background-size: cover; background-position: center; border-right: 2px solid #1B2CC2; }
        .album-tracks { width: 60%; padding: 20px; overflow-y: auto; color: white; }
        .track-item { 
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); 
            cursor: pointer; transition: 0.2s; display: flex; justify-content: space-between;
        }
        .track-item:hover { background: rgba(255,255,255,0.1); color: #4F64FF; }

        /* --- MINI PLAYER --- */
        #mini-player {
            position: fixed; bottom: 20px; left: 90px; z-index: 2000;
            width: 120px; height: 120px; border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            overflow: hidden; display: none;
            border: 2px solid #1B2CC2;
            background-size: cover; background-position: center;
        }
        .mini-controls {
            width: 100%; height: 100%; background: rgba(0,0,0,0.7);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; transition: opacity 0.3s;
        }
        #mini-player:hover .mini-controls { opacity: 1; }
        .mini-btn-row { display: flex; gap: 15px; margin-top: 5px; }
        .mini-btn { color: white; cursor: pointer; font-size: 1.2rem; transition: 0.2s; }

        /* --- SLOPE FIX: FORCE FULLSCREEN --- */
        .game-iframe { 
            width: 100%; 
            height: 100%; 
            border: none; 
            display: block;
            /* Aggressive scaling if the game tries to be small */
            object-fit: fill;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div id="setup-overlay">
        <div class="setup-card">
            <div id="step-1" class="setup-step active">
                <h3>Choose a Cloak Icon</h3>
                <div class="icon-grid">
                    <div class="icon-opt" onclick="selIcon(this, 'https://google.com/favicon.ico')"><i class="fab fa-google"></i></div>
                    <div class="icon-opt" onclick="selIcon(this, 'https://drive.google.com/favicon.ico')"><i class="fab fa-google-drive"></i></div>
                    <div class="icon-opt" onclick="selIcon(this, 'https://classroom.google.com/favicon.ico')"><i class="fas fa-graduation-cap"></i></div>
                    <div class="icon-opt" onclick="selIcon(this, 'https://clever.com/favicon.ico')"><i class="fas fa-infinity"></i></div>
                    <div class="icon-opt" onclick="selIcon(this, 'https://canvas.instructure.com/favicon.ico')"><i class="fas fa-book"></i></div>
                    <div class="icon-opt" onclick="selIcon(this, 'https://wikipedia.org/favicon.ico')"><i class="fab fa-wikipedia-w"></i></div>
                </div>
                <button class="setup-btn" onclick="nextStep(2)">Next</button>
            </div>
            <div id="step-2" class="setup-step">
                <h3>Tab Title Cloak</h3>
                <input type="text" id="cloak-text" class="setup-input" placeholder="e.g. My Drive - Google">
                <button class="setup-btn" onclick="nextStep(3)">Next</button>
            </div>
            <div id="step-3" class="setup-step">
                <h3>Panic Settings</h3>
                <select id="panic-url" class="setup-input">
                    <option value="https://clever.com">Clever</option>
                    <option value="https://classroom.google.com">Google Classroom</option>
                    <option value="https://khanacademy.org">Khan Academy</option>
                </select>
                <input type="text" id="panic-key" class="setup-input" maxlength="1" placeholder="Panic Key (e.g. P)">
                <button class="setup-btn" onclick="finishSetup()">Submit & Save</button>
            </div>
        </div>
    </div>

    <canvas id="particle-canvas"></canvas>

    <nav class="sidebar">
        <div class="nav-item active" id="btn-home" onclick="switchTab('home')"><i class="fas fa-home"></i></div>
        <div class="nav-item" id="btn-games" onclick="switchTab('games')"><i class="fas fa-gamepad"></i></div>
        <div class="nav-item" id="btn-music" onclick="switchTab('music')"><i class="fas fa-music"></i></div>
        <div class="spacer"></div>
        <div class="nav-item" onclick="localStorage.clear(); location.reload();"><i class="fas fa-sync"></i></div>
    </nav>

    <div id="mini-player">
        <div class="mini-controls">
            <div style="font-size: 10px; margin-bottom: 5px;">NOW PLAYING</div>
            <div class="mini-btn-row">
                <i class="fas fa-backward mini-btn" onclick="prevSong()"></i>
                <i id="mini-play-btn" class="fas fa-pause mini-btn" onclick="toggleMusic()"></i>
                <i class="fas fa-forward mini-btn" onclick="nextSong()"></i>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div id="view-home" class="view-section active-view">
            <h1 style="font-size: 4rem; color: #4F64FF; margin-top: 20vh;">Brix</h1>
            <p style="color: #ccc;">The New and Improved.</p>
        </div>

        <div id="view-games" class="view-section">
            <div class="grid-container">
                <h2 class="grid-title">Game Library</h2>
                <div class="grid-wrapper">
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/10minutestilldawn.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/10-minutes-till-dawn_1x1.jpeg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>10 Minutes Till Dawn</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/12minibattles.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/12minibattles.png" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>12 Mini Batles</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/1on1soccer.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/1-on-1-soccer.jpg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>1 On 1 Soccer</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/1on1tennis.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/1on1tennis.jpg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>1 On 1 Tennis</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/1v1.lol.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/1v1%20loo.jpeg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>1v1.lol</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/2048.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/2048logo.jpeg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>2048</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/3Dflightsimulator.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/3dflight.jpeg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>3D Flight Simulator</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/agariolite.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/agario.png" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>Agar.io</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/ageofwar.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/ageofwar.jpeg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>Age of War</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githubusercontent.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/ageofwar2.html')">
                        <img src="https://raw.githubusercontent.com/xxuep/games/main/images/ageofwar2.jpg" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>Age of War 2</b></div>
                    </div>
                    <div class="card" onclick="launchGame('https://raw.githack.com/CoolDude2349/Offline-HTML-Games-Pack/master/offline/slope.html')">
                        <img src="https://picsum.photos/600/300?random=12" class="card-image" style="aspect-ratio: 2/1;">
                        <div class="card-info"><b>Slope</b></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-music" class="view-section">
            <div class="grid-container">
                <h2 class="grid-title">Music Library</h2>
                <div class="grid-wrapper">
                    <div class="card" onclick="openAlbum('album1')">
                        <img src="https://picsum.photos/400/400?random=1" class="card-image">
                        <div class="card-info"><b>LoFi Beats</b></div>
                    </div>
                    <div class="card" onclick="openAlbum('album2')">
                        <img src="https://picsum.photos/400/400?random=2" class="card-image">
                        <div class="card-info"><b>Phonk Mix</b></div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="modal-overlay" id="modal-overlay">
        <div class="modal-window">
            <div class="window-controls">
                <button class="win-btn min-btn" onclick="minimizeModal()">-</button>
                <button class="win-btn close-btn" onclick="closeModal()">X</button>
            </div>
            <div id="modal-body" style="width:100%; height:100%;"></div>
        </div>
    </div>

    <script>
        // --- SETUP WIZARD ---
        let selectedFavicon = '';
        if(localStorage.getItem('brix-setup')) {
            document.getElementById('setup-overlay').style.display = 'none';
            applyCloak();
        }

        function selIcon(el, url) {
            document.querySelectorAll('.icon-opt').forEach(i => i.classList.remove('selected'));
            el.classList.add('selected');
            selectedFavicon = url;
        }

        function nextStep(step) {
            document.querySelectorAll('.setup-step').forEach(s => s.classList.remove('active'));
            document.getElementById('step-' + step).classList.add('active');
        }

        function finishSetup() {
            const data = {
                icon: selectedFavicon || 'https://google.com/favicon.ico',
                title: document.getElementById('cloak-text').value || 'Classes',
                panicUrl: document.getElementById('panic-url').value,
                panicKey: document.getElementById('panic-key').value.toUpperCase() || 'P'
            };
            localStorage.setItem('brix-setup', JSON.stringify(data));
            document.getElementById('setup-overlay').style.display = 'none';
            applyCloak();
        }

        function applyCloak() {
            const data = JSON.parse(localStorage.getItem('brix-setup'));
            document.title = data.title;
            let link = document.querySelector("link[rel*='icon']") || document.createElement('link');
            link.type = 'image/x-icon'; link.rel = 'shortcut icon'; link.href = data.icon;
            document.getElementsByTagName('head')[0].appendChild(link);
            window.addEventListener('keydown', (e) => {
                if(e.shiftKey && e.key.toUpperCase() === data.panicKey) window.location.href = data.panicUrl;
            });
        }

        // --- NAVIGATION ---
        function switchTab(tab) {
            document.querySelectorAll('.view-section').forEach(s => s.classList.remove('active-view'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('view-' + tab).classList.add('active-view');
            document.getElementById('btn-' + tab).classList.add('active');
        }

        // --- GAME LAUNCHER (FIXED CONNECTION) ---
        const modal = document.getElementById('modal-overlay');
        const body = document.getElementById('modal-body');

        function launchGame(targetUrl) {
            // Pause music to prevent audio overlap
            if(!audioPlayer.paused) audioPlayer.pause();
            updateMiniPlayerState(false);

            modal.style.display = 'flex';
            body.innerHTML = ''; 
            
            // Using raw.githack.com instead of raw.githubusercontent.com 
            // This bypasses the security block while loading the EXACT same file.
            const fixedUrl = targetUrl.replace('raw.githubusercontent.com', 'raw.githack.com');
            
            const iframe = document.createElement('iframe');
            iframe.src = fixedUrl;
            iframe.className = 'game-iframe';
            body.appendChild(iframe);
        }

        // --- MUSIC SYSTEM ---
        const musicData = {
            'album1': {
                title: "LoFi Beats",
                art: "https://picsum.photos/400/400?random=1",
                songs: [
                    { title: "Chill Vibes", url: "https://github.com/rafaelreis-hotmart/Audio-Sample-files/raw/master/sample.mp3" },
                    { title: "Study Time", url: "https://github.com/rafaelreis-hotmart/Audio-Sample-files/raw/master/sample.mp3" }
                ]
            },
            'album2': {
                title: "Phonk Mix",
                art: "https://picsum.photos/400/400?random=2",
                songs: [
                    { title: "Drift King", url: "https://github.com/rafaelreis-hotmart/Audio-Sample-files/raw/master/sample.mp3" }
                ]
            }
        };

        let currentAlbumId = null;
        let currentSongIndex = 0;
        let audioPlayer = new Audio();
        let isMusicModalOpen = false;

        function openAlbum(albumId) {
            isMusicModalOpen = true;
            modal.style.display = 'flex';
            const album = musicData[albumId];
            
            let tracksHTML = '';
            album.songs.forEach((song, index) => {
                tracksHTML += `<div class="track-item" onclick="playSong('${albumId}', ${index})">
                    <span>${index + 1}. ${song.title}</span>
                    <span><i class="fas fa-play"></i></span>
                </div>`;
            });

            body.innerHTML = `<div class="album-view">
                <div class="album-art-large" style="background-image: url('${album.art}')"></div>
                <div class="album-tracks"><h2>${album.title}</h2>${tracksHTML}</div>
            </div>`;
        }

        function playSong(albumId, index) {
            currentAlbumId = albumId;
            currentSongIndex = index;
            const song = musicData[albumId].songs[index];
            audioPlayer.src = song.url;
            audioPlayer.play();
            updateMiniPlayer();
            updateMiniPlayerState(true);
        }

        function updateMiniPlayer() {
            const mini = document.getElementById('mini-player');
            mini.style.display = 'block';
            mini.style.backgroundImage = `url('${musicData[currentAlbumId].art}')`;
        }

        function toggleMusic() {
            if(audioPlayer.paused) { audioPlayer.play(); updateMiniPlayerState(true); }
            else { audioPlayer.pause(); updateMiniPlayerState(false); }
        }

        function updateMiniPlayerState(isPlaying) {
            document.getElementById('mini-play-btn').className = isPlaying ? "fas fa-pause mini-btn" : "fas fa-play mini-btn";
        }

        function nextSong() {
            if(!currentAlbumId) return;
            currentSongIndex = (currentSongIndex + 1) % musicData[currentAlbumId].songs.length;
            playSong(currentAlbumId, currentSongIndex);
        }

        function prevSong() {
            if(!currentAlbumId) return;
            currentSongIndex = (currentSongIndex - 1 + musicData[currentAlbumId].songs.length) % musicData[currentAlbumId].songs.length;
            playSong(currentAlbumId, currentSongIndex);
        }

        audioPlayer.onended = nextSong;

        function minimizeModal() { modal.style.display = 'none'; isMusicModalOpen = false; }

        function closeModal() {
            audioPlayer.pause();
            document.getElementById('mini-player').style.display = 'none';
            modal.style.display = 'none';
            body.innerHTML = '';
            isMusicModalOpen = false;
        }

        // --- PARTICLES ---
        const canvas = document.getElementById('particle-canvas');
        const ctx = canvas.getContext('2d');
        let pts = [];
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.onresize = resize; resize();
        class Particle {
            constructor() { this.reset(); }
            reset() { this.x = Math.random()*canvas.width; this.y = Math.random()*canvas.height; this.vx = (Math.random()-0.5)*0.3; this.vy = (Math.random()-0.5)*0.3; this.s = Math.random()*2; }
            up() { this.x+=this.vx; this.y+=this.vy; if(this.x<0)this.x=canvas.width; if(this.y<0)this.y=canvas.height; if(this.x>canvas.width)this.x=0; if(this.y>canvas.height)this.y=0; }
            dr() { ctx.fillStyle = "rgba(255,255,255,0.4)"; ctx.beginPath(); ctx.arc(this.x,this.y,this.s,0,6.28); ctx.fill(); }
        }
        for(let i=0; i<100; i++) pts.push(new Particle());
        function anim() { ctx.clearRect(0,0,canvas.width,canvas.height); pts.forEach(p=>{p.up(); p.dr();}); requestAnimationFrame(anim); }
        anim();
    </script>
</body>
</html>
